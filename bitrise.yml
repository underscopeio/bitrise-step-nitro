format_version: "4"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: ""
app:
  envs:
    - BITRISE_STEP_ID: uci-builder
    - BITRISE_STEP_VERSION: 0.0.4-alpha.4
    - BITRISE_STEP_GIT_CLONE_URL: https://github.com/underscopeio/bitrise-step-uci-builder.git
    - MY_STEPLIB_REPO_FORK_GIT_URL: $MY_STEPLIB_REPO_FORK_GIT_URL
    - BITRISE_APP_URL: "app.bitrise.io/APP-SLUG/"
    - BITRISE_BUILD_SLUG: "d65abbebxfc9ca4e"
workflows:
  audit-this-step:
    steps:
      - script:
          inputs:
            - content: |-
                #!/bin/bash
                set -ex
                stepman audit --step-yml ./step.yml
  generate_readme:
    steps:
      - git::https://github.com/bitrise-steplib/steps-readme-generator.git@main:
          title: Generate README
  test_ios:
    steps:
      - change-workdir:
          title: Switch working dir to test / _tmp dir
          description: |-
            To prevent step testing issues, like referencing relative
            files with just './some-file' in the step's code, which would
            work for testing the step from this directory directly
            but would break if the step is included in another `bitrise.yml`.
          run_if: "true"
          inputs:
            - path: ./_tmp
            - is_create_path: true
      - path::./:
          title: Step Test
          description: |-
            The example input has a default value,
            you can overwrite it if you want to, just like we did below,
            but the step would use the default value specified in the `step.yml`
            file if you would not specify another value.
          run_if: "true"
          inputs:
            - platform: ios
            - project_id: $BITRISE_APP_URL
            - build_id: $BITRISE_BUILD_SLUG
            - disable_cache: "no"
            - cache_provider: fs
            - log_provider: fs
            - tracking_provider: uci-on-premise
            - ios_certificate_url: $IOS_CERTIFICATE_URL
            - ios_certificate_passphrase: $IOS_CERTIFICATE_PASSPHRASE
  test_android:
    steps:
      - change-workdir:
          title: Switch working dir to test / _tmp dir
          description: |-
            To prevent step testing issues, like referencing relative
            files with just './some-file' in the step's code, which would
            work for testing the step from this directory directly
            but would break if the step is included in another `bitrise.yml`.
          run_if: "true"
          inputs:
            - path: ./_tmp
            - is_create_path: true
      - path::./:
          title: Step Test
          description: |-
            The example input has a default value,
            you can overwrite it if you want to, just like we did below,
            but the step would use the default value specified in the `step.yml`
            file if you would not specify another value.
          run_if: "true"
          inputs:
            - platform: android
            - project_id: $BITRISE_APP_URL
            - build_id: $BITRISE_BUILD_SLUG
            - disable_cache: "no"
            - cache_provider: fs
            - log_provider: fs
            - tracking_provider: uci-on-premise
            - android_app_identifier: android.app.identifier
            - android_keystore_url: $ANDROID_KEYSTORE_URL
            - android_keystore_password: $ANDROID_KEYSTORE_PASSWORD
            - android_keystore_key_alias: $ANDROID_KEYSTORE_KEY_ALIAS
            - android_keystore_key_password: $ANDROID_KEYSTORE_KEY_PASSWORD
